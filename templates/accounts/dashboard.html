{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Charity Streaming</title>
  <!-- CoreUI CSS (version 4 par exemple via CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@coreui/coreui@5.2.0/dist/js/coreui.min.js" integrity="sha384-c4nHOtHRPhkHqJsqK5SH1UkyoL2HUUhzGfzGkchJjwIrAlaYVBv+yeU8EYYxW6h5" crossorigin="anonymous"></script>
  <!-- Bootstrap 5 CSS (si nécessaire pour compléter CoreUI) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <style>
    /* Quelques styles personnalisés pour le dashboard */
    .sidebar { width: 250px; }
    .content { margin-left: 250px; }
    @media (max-width: 768px) {
      .content { margin-left: 0; }
      .sidebar { width: 100%; }
    }
  </style>
</head>
<body class="c-app">
  <!-- Sidebar CoreUI -->
  <div class="c-sidebar c-sidebar-dark c-sidebar-fixed c-sidebar-lg-show sidebar">
    <div class="c-sidebar-brand d-lg-down-none">
      <h3>Charity Streaming</h3>
    </div>
    <ul class="c-sidebar-nav">
      <li class="c-sidebar-nav-item">
        <a class="c-sidebar-nav-link" href="{% url 'accounts:dashboard' %}">
          <i class="c-sidebar-nav-icon fas fa-user"></i> Mon Profil
        </a>
      </li>
      <li class="c-sidebar-nav-item">
        <a class="c-sidebar-nav-link" href="{% url 'notifications:dashboard' %}">
          <i class="c-sidebar-nav-icon fas fa-bell"></i> Notifications
          {% if notif_count > 0 %}
            <span class="badge bg-danger">{{ notif_count }}</span>
          {% endif %}
        </a>
      </li>
      {% if is_staff %}
      <li class="c-sidebar-nav-title">Staff</li>
      <li class="c-sidebar-nav-item">
        <a class="c-sidebar-nav-link" href="{% url 'staff:staff_effectif' %}">
          <i class="c-sidebar-nav-icon fas fa-users"></i> Staff Effectif
        </a>
      </li>
      <li class="c-sidebar-nav-item">
        <a class="c-sidebar-nav-link" href="{% url 'staff:candidatures' %}">
          <i class="c-sidebar-nav-icon fas fa-user-plus"></i> Candidatures
        </a>
      </li>
      <li class="c-sidebar-nav-item">
        <a class="c-sidebar-nav-link" href="{% url 'staff:reserve' %}">
          <i class="c-sidebar-nav-icon fas fa-user-clock"></i> Réserve
        </a>
      </li>
      <li class="c-sidebar-nav-item">
        <a class="c-sidebar-nav-link" href="{% url 'staff:postes' %}">
          <i class="c-sidebar-nav-icon fas fa-briefcase"></i> Postes
        </a>
      </li>
      {% endif %}
    </ul>
  </div>

  <!-- Main content -->
  <div class="c-wrapper content">
    <header class="c-header c-header-light">
      <div class="container-fluid">
        <div class="c-header-brand d-lg-none">
          <h3>Charity Streaming</h3>
        </div>
        <ul class="c-header-nav ms-auto">
          <li class="c-header-nav-item">
            <a class="c-header-nav-link" href="{% url 'accounts:logout' %}">
              <i class="fas fa-sign-out-alt"></i> Déconnexion
            </a>
          </li>
        </ul>
      </div>
    </header>

    <div class="c-body">
      <main class="c-main">
        <div class="container-fluid">
          <div class="card mb-4">
            <div class="card-header">
              <h4>Résumé du profil</h4>
            </div>
            <div class="card-body">
              <p><strong>Nom d'utilisateur :</strong> {{ user.username }}</p>
              {% if is_streamer %}
                <p><strong>Twitch :</strong> {{ user.streamer_profile.twitch_name }}</p>
              {% endif %}
              {% if is_staff and staff_app %}
                <p><strong>Poste demandé :</strong> {{ staff_app.poste_demande.poste }}</p>
                <p><strong>Status :</strong> {{ staff_app.get_status_display }}</p>
              {% endif %}
              <a href="{% url 'accounts:profile_edit' %}" class="btn btn-primary">Éditer mon profil</a>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-header">
              <h4>Notifications</h4>
            </div>
            <div class="card-body">
              {% if notifications %}
                <ul class="list-group">
                  {% for notif in notifications %}
                    <li class="list-group-item">
                      <i class="fas fa-bell"></i> {{ notif.title }} - {{ notif.message }}
                      <a href="{% url 'notifications:mark_notification_as_read' notif.id %}" class="btn btn-sm btn-success float-end">Marquer comme lue</a>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p>Aucune notification non lue.</p>
              {% endif %}
            </div>
          </div>

          <!-- Section spécifique pour Staff -->
          {% if is_staff and staff_app %}
          <div class="card mb-4">
            <div class="card-header">
              <h4>Détails Staff</h4>
            </div>
            <div class="card-body">
              <p><strong>Poste demandé :</strong> {{ staff_app.poste_demande.poste }}</p>
              <p><strong>Status :</strong> {{ staff_app.get_status_display }}</p>
              <p><strong>Postes requis :</strong> {{ staff_app.poste_demande.nombre_de_postes }}</p>
              <p><strong>Postes disponibles :</strong> {{ staff_app.postes_disponibles }}</p>
              <p><strong>Nombre de réservistes :</strong> {{ staff_app.nombre_reserve }}</p>
            </div>
          </div>
          {% endif %}

        </div>
      </main>
    </div>

    <footer class="c-footer">
      <div><a href="#">Charity Streaming</a> &copy; 2025</div>
    </footer>
  </div>

  <!-- CoreUI and Bootstrap Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/@coreui/coreui@4.2.1/dist/js/coreui.bundle.min.js"></script>
  <!-- Placeholder pour WebSocket / rafraîchissement des notifications -->
  <script>
    // Exemple : Mise à jour automatique du badge notifications via WebSocket ou polling AJAX
    // (Implémentation réelle à ajouter selon votre solution de WebSocket/Django Channels)
  </script>
</body>
</html>
